---
stages:
  - pre-commit
  - build
  - publish-docs-gitlab

include:
  - project: saltstack/pop/cicd/ci-templates
    file: /docswork/url-tester-brok.yml
  - project: saltstack/pop/cicd/ci-templates
    file: /docswork/build-docs-html-nox.yml
  - project: saltstack/pop/cicd/ci-templates
    file: /docswork/publish-docs-gitlab.yml

pre-commit:
  stage: pre-commit
  image: python:3.8-bullseye
  script:
    - pip install -U pip setuptools wheel
    - pip install -r requirements-dev.txt
    - wget https://github.com/errata-ai/vale/releases/download/v2.10.5/vale_2.10.5_Linux_64-bit.tar.gz -O - | tar xz -C /usr/local/bin/ vale
    - wget https://github.com/vmware-tanzu/carvel-vendir/releases/download/v0.22.0/vendir-linux-amd64 -O /usr/local/bin/vendir && chmod 0755 /usr/local/bin/vendir
    - pre-commit install
    - pre-commit run -a -v --color always
